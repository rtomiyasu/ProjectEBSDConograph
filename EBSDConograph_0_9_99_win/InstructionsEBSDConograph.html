<html lang="en">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="description" content="Distibution of EBSD ab-initio indexing program based on the CONOGRAPH method."> 
<meta name="keywords" content="Kikuchi pattern, Electron backscatter diffraction, EBSD, software, open source, download, CONOGRAPH">
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" }},
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    },
    "HTML-CSS": { matchFontHeight: false },
    displayAlign: "left",
    displayIndent: "2em"
  });
</script>
<style type="text/css">
   body { line-height: 1.5; }
   p{text-indent:1em;}
</style>
<style>
.bracket{
 counter-reset:item;
 list-style:none;
}
.bracket li:before{
 content:"[" counters(item, "-") "]";
 counter-increment:item;
 margin-right:0.5em;
}
.bracket li{
 padding-left:1.5em;
 text-indent:-1.5em;
}
</style>
<head>
<title> Instructions for EBSD-CONOGRAPH (CUI version) </title>
</head>
<body>
<font size="+1"><b> Instructions for EBSD-CONOGRAPH (CUI version) </b></font><br>
<font size="-1" color="#339999"> [English / <a href="InstructionsEBSDConograph_JP.html">Japanese</a>] </font><br>
<p>
This page explains the open source software EBSD-CONOGRAPH Version 0.99 (<a href="https://osdn.net/projects/ebsd-conograph/releases/">download page</a> in OSDN.jp).
The software executes ab-initio indexing of Kikuchi patterns (Figure 1) obtained by electron Backscatter Diffraction (EBSD).
The indexing method is based on the CONOGRAPH method originally invented for the powder auto-indexing software <a href="https://conograph.osdn.jp/ConographGUI/web_page.html">Conograph</a>.
</p>
<div align="center"><figure>
   <img src="figures/KikuchiPattern.png" width="900" height="389" alt="Figure 1">
   <figcaption " align="center"><font color="blue">Figure 1 : Kikuchi Pattern (Simulation data of steel) and a result of band extraction. 
Yellow lines indicate band centers (or lines parallel to them). <BR>
The red segments, which are parts of the perpendicular lines through the pattern center, indicate the band widths.</font>
</figcaption></figure></div>

<p>
Before starting the software, it is necessary to extract the following information from the Kikuchi pattern and input them from data.txt:
<ol>
 <LI> band-center positions (&phi;, &sigma;),</LI>
 <LI> band widths (&sigma;<sub>begin</sub>, &sigma;<sub>end</sub>).</LI>
</ol>
</p>
<p>
EBSD indexing programs should also include codes for automatic PC calibration and band detection, 
but these functions have not been yet implemented into the distributed software.
This also reflects the current situation that
methods for each stage are still begin studied in order to improve their accuracy and reliability.
</p>
<p>
Methods and programs for ab-initio indexing can be developed independently from the above preprocessing stages.
Even if the PC and band positions include errors to some degree, 
it is possible to estimate the unitcell parameters, 
although the following principle problems cannot be avoided:
<ul type="circle">
 <LI> errors in the projection center, band center positions and band widths increase the errors and the uncertainties in the obtained unitcell parameters.</LI>
 <LI> there is an ambiguity in the ab-initio indexing (<i>i.e.</i>, multiple distinct solutions can be as good as the correct one),
 which happens, in particular, in case of unclear band edges and unitcells with low symmetry [1].
</LI>
</ul>
</p>

<h2>FAQ</h2>
<ul>
    <li><a href="#HowtoUse">How to use the EBSD-CONOGRAPH program</a></li>
    <li><a href="#InputOutputFiles">On the contents of the input and output files</a></li>
<ul>
    <li><a href="#InputFiles">Input files</a></li>
    <li><a href="#OutputFile">Output parameters</a></li>
    <li><a href="#FigureOfMerit">Figure of merit M<sup>new</sup></a></li>
</ul>
    <li><a href="#ParametersToModify">When results are not satisfactory, which parameters in the input.txt should be modified?</a>
    </li>
    <li><a href="#HowtoReportBugs">How do I report bugs?</a></li>
    <li><a href="#copyright">About the copyright</a></li>
</ul>

<h3><a name="HowtoUse">How to use the EBSD-CONOGRAPH program</a></h3>
<ol>
<LI> The software EBSD-CONOGRAPH requires the following data.txt and input.txt as input files. 
(Examples can be found in the Sample folder.)
 <UL>
  <LI> input.txt: includes input parameters to adjust the search method and the output.
    (<a href="sample/Fe(three_columns,use_band_widths)/input.txt">Example</a>)
  </LI>
  <LI> data.txt: includes information about the band center positions and band widths.
   <ul>
    <LI> Example 1: <a href="sample/Fe(three_columns,use_band_widths)/data.txt">data.txt</a> (3 columns: &phi;, &sigma;<sub>begin</sub>, &sigma;<sub>end</sub>. The &sigma; is set to (&sigma;<sub>begin</sub> + &sigma;<sub>end</sub>)/2 in this case), </LI>
    <LI> Example 2: <a href="sample/Fe(four_columns,use_only_band_centers)/data.txt">data.txt</a> (4 columns: &phi;, &sigma;, &sigma;<sub>begin</sub>, &sigma;<sub>end</sub>). </LI>
   </ul>
   The flag 0/1 in the first line of data.txt indicates either of the following options:
   <ul>
    <LI> 1: estimation of the unitcell parameters from &phi;, &sigma;, &sigma;<sub>begin</sub> and &sigma;<sub>end</sub> <BR>
        * The uncertainties of the unitcell parameters are increased in this case, because of errors in band widths (<i>i.e.</i>, &sigma;<sub>begin</sub> and &sigma;<sub>end</sub>.</LI>
    <LI> 0: estimation of the length ratios a/c, b/c and the angles &alpha;, &beta;, &gamma; based on only &phi; and &sigma;.
    </LI>
   </ul>
  </LI>
 </UL>
</LI>
<LI>
	Copy one of the folders from the Sample folder.
	Modify the contents of data.txt (and input.txt in order to improve the indexing results).
</LI>

<LI> Open a command prompt or terminal window in your operating system. <BR>
     Change the current folder to the same folder that contains the modified input files.</LI>

<LI> Enter the path to the EBSDConograph.exe file on the Command Prompt window and execute EBSDConograph.</LI>
</ol>

<h3><a name="InputOutputFiles">On the contents of the input and output files</a></h3>

<h4><a name="InputFiles">Input files</a></h4>
<p>
Figure 2 explains how &phi;, &sigma;, &sigma;<sub>begin</sub>, &sigma;<sub>end</sub> are provided by the band positions and widths in an EBSD image.
</p>
<div align="center"><figure>
   <img src="figures/KosselCone.png" width="900" height="241" alt="Figure 1">
   <figcaption " align="left"><font color="blue">Figure 2: (a) band center lines can be regarded as 
the intersections of the phosphor screen and diffracting planes through the projection center (PC).
The pattern center O is the foot of the perpendicular line from the PC to the phosphor screen.
(b) band edges are 
the intersections of the phosphor screen and conical surfaces (the so called, Kossel cones).
They are parts of hyperbola lines (<a href ="html/FormulasForEBSDBandEdges.html">formula</a>).
In (c), the phosphor screen is parallel to the sheet. The unit of the length is fixed so that the camera length (= distance between the PC and the screen) equals 1. 
The &phi; is the angle between the x-axis and the perpendicular line  from O to the band center line.
The &sigma;, &sigma;<sub>begin</sub>, &sigma;<sub>end</sub> are obtained
from the distances of the center lines or the band edges from O. </font>
   </figcaption></figure></div>
<p>
The band widths are necessary in order to 
uniquely 
determine the ratios a/c, b/c and the angles &alpha;, &beta;, &gamma;,
and obtain the unitcell scale (and hence, a, b, c).
In fact, the Bragg angle &theta; is obtained from the band width by
2 &theta; = &sigma;<sub>end</sub> - &sigma;<sub>begin</sub>.
Futhermore, by the Bragg's law, 
\begin{eqnarray*}
	2 d \sin \theta = n \lambda, 
	&& d: \text{d-spacing of the diffracting plane}, \\
	&& n: \text{integer},\quad \lambda: \text{wave length of the electron beam}.
\end{eqnarray*}
Thus, if $n a^*$ ($n$: integer) are 
the reciprocal lattice vectors orthogonal to the diffracting plain,
\begin{eqnarray}
	\sin \theta = n \lambda/2 d = \left| n a^* \right| \lambda/2, \quad | &ensp; | \text{ is the vector length}. 
\end{eqnarray}
As a result of Eq.(1), 
the bands correponding to the Miller indices $n (h k \ell)$ of $n a^*$ (n: integer),
have the identical center lines but distinct band widths. 
Normally the band edges with $n = \pm 1$ are the most clearly observed.
However, visible bands are influenced by the magnitudes of structure factors 
and reflection rules due to the space-group symmetry (Nolze & Winkelmann, 2017), and furthermore, there seem to be exceptions (Fig. of Day (2008)).
</p>
<h4><a name="OutputFile">Output file</a></h4>
<p> The following are the output files of the software:
<ul type="square">
 <LI> Example 1: <a href="sample/Fe(three_columns,use_band_widths)/output/out.txt">out.txt</a> (when band widths are also used), </LI>
 <LI> Example 2: <a href="sample/Fe(four_columns,use_only_band_centers)/output/out.txt">out.txt</a> (when only &phi; and &sigma; are used). </LI>
</ul>
</p>
<p>
In the output files, candidate unitcells are classified by their Bravais types, 
and sorted by the values of the figure of merit (M<sup>new</sup>) defined in [1].
The following parameters are also output, after they are refined by using a non-linear squares method:
<ol>
 <LI> The basis $a_1$, $a_2$, $a_3$ of the crystal lattice that satisfies the following equation, and the estimated errors of their components:
\[
 \begin{pmatrix}
		a_1 \cdot a_1 & a_1 \cdot a_2 & a_1 \cdot a_3 \\
		a_2 \cdot a_1 & a_2 \cdot a_2 & a_2 \cdot a_3 \\
		a_3 \cdot a_1 & a_3 \cdot a_2 & a_3 \cdot a_3 \\
     \end{pmatrix}
 = 
  \begin{pmatrix}
		a^2 & ab \cos \gamma & ac \cos \beta \\
		ab \cos \gamma & b^2 & bc \cos \alpha \\
		ac \cos \beta    & bc \cos \alpha & c^2
  \end{pmatrix},
\quad a, b, c, \alpha, \beta, \gamma: \text{unitcell parameters}.
\]
 </LI>
 <LI> Euler angles &theta;<sub>1</sub>, &theta;<sub>2</sub>, &theta;<sub>3</sub>
 that represents the direction of the lattice (more precisely, the following orthogonal matrix $G$), and their estimated errors:
\[
	G := L^{-1} A =
	\begin{pmatrix}
		\cos \theta_1 & \sin \theta_1 & 0 \\
		-\sin \theta_1 & \cos \theta_1 & 0 \\
		0 & 0 & 1 \\
	\end{pmatrix}
	\begin{pmatrix}
		1 & 0 & 0 \\
		0 & \cos \theta_2 & \sin \theta_2 \\
		0 & -\sin \theta_2 & \cos \theta_2 \\
	\end{pmatrix}
	\begin{pmatrix}
		\cos \theta_3 & \sin \theta_3 & 0 \\
		-\sin \theta_3 & \cos \theta_3 & 0 \\
		0 & 0 & 1 \\
	\end{pmatrix},
\]
	where $A$ is the $3 \times 3$ matrix with the row vectors $a_1$, $a_2$, $a_3$, and $L$ is the lower triangle matrix with $L L^T = A A^T$.
 </LI>
 <LI> Projection-center shift &Delta; x, &Delta; y, &Delta; z, and their estimated errors.
If the camera length and the pattern-center coordinate used to make the input file data.txt
are denoted by $L^{obs}$ and $(X^{old}, Y^{old})$, 
the new camera length and the pattern-center coordinate are given by:
\begin{eqnarray*}
L^{new} &=& (1 - \Delta z) L^{old}, \\
(X^{new}, Y^{new}) &=& (X^{old}, Y^{old}) + (L^{old} \Delta x, L^{old} \Delta y).
\end{eqnarray*}
 </LI>
</ol>
The following should be noted, with regard to the above parameters:
<ul type="circle">
 <LI> in some cases, the parameters become worse by the refinement process, 
 as a result of changes in the Miller indices assigned to the bands.</LI>
 <LI> the above estimated errors are 
 propagation errors, when it is assumed in the non-linear least squares method that
 the input angles &phi;, &sigma;, &sigma;<sub>begin</sub>, &sigma;<sub>end</sub> have errors 
within 1 degree.</LI>
</ul>
</p>
<h4><a name="FigureOfMerit">Figure of merit M<sup>new</sup></a></h4>
<p>
Since M<sup>new</sup> is a generalization of the de Wolff M used in powder indexing, 
M and M<sup>new</sup> have similar properties, except that M prefers higher-symmetric cells (<i>c.f.</i> &#9317; of Table 5-2, page 5-5 of <a href="https://conograph.osdn.jp/ConographGUI/manual_win_en.pdf">CONOGRAPH manual</a>).
Namely, 
<ul>
 <LI> If M<sup>new</sup> > 10 for some unitcells, there are much possibility that the correct solution has been obtained.
 <LI> The correct solution should be one of the unitcells that gained approximately the largest M<sup>new</sup> value.
 <Li> Similar unitcell parameters have similar M<sup>new</sup> values, even if they belong to distinct Bravais types.
</ul>
Therefore, user should check both the value of the figure of merit and the Bravais types, 
when selecting the correct solution from the output list.
</p>

<h3><a name="ParametersToModify">When results are not satisfactory, which parameters in input.txt should be modified?</a></h3>
<p>
The following two options can be chosen as a searching method:
<UL type="circle">
	<LI> Quick search (often enough for unitcells with high symmetry), </LI>
	<LI> Exhaustive search (for all cases). </LI>
</UL>
</p>
<p> The searched region can be also expanded by increasing the following parameters (the upper ones are more influential. Also see explanations in input.txt),
although comparatively large numbers are already used in the attached input.txt:
<UL>
 	<LI> Upper bound on errors in phi, sigma, sigma_begin, sigma_end: 1 degree, </LI>
 	<LI> Max |h|,|k|,|l| used for indexing                          : 7, </LI>
 	<LI> Tolerance level for errors in the unitcell scales          : 3., </LI>
 	<LI> Resolution for Bravais-type determination                  : 0.02. </LI>
</UL>
</p>

<h3><a name="HowtoReportBugs">How do I report bugs?</a></h3>
<p>
You should send us a bug report with 
<u>all the input and output files attached (including LOG_CONOGRAPH.txt)</u> to the following e-mail address: 
<UL>
<LI> tomiyasu (at) imi.kyushu-u.ac.jp
</UL>
</p>

<h3><a name="Citation">How do I cite EBSD-CONOGRAPH?</a></h3>
<p>
If you use the program for your research, we strongly encourage you to include a citation of the following article in the bibliography.
<OL class="bracket">
<LI> R. Oishi-Tomiyasu, T. Tanaka, J. Nakagawa, 
&#147;Distribution rules of systematic absence and generalized deWolff figure of merit applied to EBSD ab-initio indexing&#148;, 
<a href="https://arxiv.org/abs/2003.13403">arxiv</a>.
</LI>
</OL>
</p>

<h3><a name="copyright">About the copyright</a></h3>
<p>
The source codes are distributed as open source under the MIT license on the <a href="https://osdn.net/projects/ebsd-conograph/scm/">repository list</a> of the EBSD-Conograph project（As of 24/3/2020）.
</p>

<A HREF="#">[Back to top]</A>
<A HREF="https://researchmap.jp/rtomiyasu/works?lang=en">[Go to my research page (list of software)]</A>
</body>

